<button [routerLink]="['/home']" class="back-button">‚Üê Back to Home</button>

<div class="library-container">
  <div class="library-header">
    <h2>My Library</h2>
    <p class="library-subtitle">Your personal collection of books</p>
  </div>

  <!-- Library Controls -->
  <div class="library-controls">
    <!-- View Toggle -->
    <div class="view-toggle">
      <button 
        [class.active]="viewMode === 'grid'" 
        (click)="setViewMode('grid')" 
        class="view-btn"
        title="Grid View">
        <span class="view-icon">‚äû</span>
      </button>
      <button 
        [class.active]="viewMode === 'list'" 
        (click)="setViewMode('list')" 
        class="view-btn"
        title="List View">
        <span class="view-icon">‚ò∞</span>
      </button>
    </div>

    <!-- Filters -->
    <div class="filter-section">
      <div class="filter-group">
        <label>Genre:</label>
        <div class="filter-chips">
          <button 
            *ngFor="let genre of availableGenres" 
            [class.active]="selectedGenres.includes(genre)"
            (click)="toggleGenreFilter(genre)"
            class="filter-chip">
            {{ genre }}
          </button>
        </div>
      </div>

      <div class="filter-group">
        <label>Year:</label>
        <div class="filter-chips">
          <button 
            *ngFor="let year of availableYears" 
            [class.active]="selectedYears.includes(year)"
            (click)="toggleYearFilter(year)"
            class="filter-chip">
            {{ year }}
          </button>
        </div>
      </div>

      <div class="filter-group">
        <label>Rating:</label>
        <div class="filter-chips">
          <button 
            *ngFor="let rating of availableRatings" 
            [class.active]="selectedRatings.includes(rating)"
            (click)="toggleRatingFilter(rating)"
            class="filter-chip">
            {{ rating }}‚òÖ
          </button>
        </div>
      </div>
    </div>

    <!-- Sort -->
    <div class="sort-section">
      <label for="sortSelect">Sort by:</label>
      <select id="sortSelect" [(ngModel)]="sortBy" (change)="onSortChange()" class="sort-select">
        <option value="title">Title A-Z</option>
        <option value="title-desc">Title Z-A</option>
        <option value="author">Author A-Z</option>
        <option value="author-desc">Author Z-A</option>
        <option value="rating">Rating (High to Low)</option>
        <option value="rating-desc">Rating (Low to High)</option>
        <option value="date-added">Date Added</option>
      </select>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredLibraryBooks.length === 0" class="empty-state">
    <div class="empty-icon">üìö</div>
    <h3>No books found</h3>
    <p *ngIf="hasActiveFilters()">Try adjusting your filters or search criteria.</p>
    <p *ngIf="!hasActiveFilters()">You haven't added any books to your library yet.</p>
    <button class="browse-btn" [routerLink]="['/home']">Browse Books</button>
  </div>

  <!-- Book Grid/List -->
  <div class="book-container" [class.list-view]="viewMode === 'list'">
    <div class="book-card" *ngFor="let book of filteredLibraryBooks; let i = index">
      <div class="book-cover-container">
        <img [src]="book.coverImage" [alt]="book.title" class="book-cover" />
        <div class="book-overlay">
          <button class="favorite-btn" (click)="toggleFavorite(book)" [class.favorited]="book.isFavorite">
            <span class="heart-icon">{{ book.isFavorite ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
          </button>
          <button class="remove-btn" (click)="removeBook(i)" title="Remove from Library">
            üóëÔ∏è
          </button>
        </div>
      </div>
      
      <div class="book-info">
        <h3 class="book-title">{{ book.title }}</h3>
        <p class="book-author">by {{ book.author }}</p>
        <p class="book-genre"><strong>Genre:</strong> {{ book.genre }}</p>
        <div class="book-rating">
          <span class="stars">
            <span *ngFor="let star of [1,2,3,4,5]" 
                  [class.filled]="star <= (book.rating || 0)"
                  class="star"
                  (click)="rateBook(book, star)"
                  title="Rate {{star}} star{{star>1?'s':''}}">‚òÖ</span>
          </span>
          <span class="rating-text">{{ book.rating || 0 }}/5</span>
        </div>
        <p class="book-date" *ngIf="book.dateAdded">
          <strong>Added:</strong> {{ book.dateAdded | date:'mediumDate' }}
        </p>
      </div>
    </div>
  </div>

  <!-- Load More -->
  <div class="load-more" *ngIf="hasMoreBooks && filteredLibraryBooks.length > 0">
    <button class="load-more-btn" (click)="loadMoreBooks()" [disabled]="isLoading">
      {{ isLoading ? 'Loading...' : 'Load More Books' }}
    </button>
  </div>
</div>
