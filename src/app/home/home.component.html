<app-navbar (search)="onSearch($event)"></app-navbar>

<!-- Hero Section -->
<div class="hero-section">
  <!-- Animated Background Elements -->
  <div class="floating-elements">
    <div class="floating-book" *ngFor="let i of [1,2,3,4,5,6,7,8]" [style.animation-delay]="(i * 0.5) + 's'">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
    </div>
    <div class="floating-star" *ngFor="let i of [1,2,3,4,5]" [style.animation-delay]="(i * 0.8) + 's'">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none">
        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
      </svg>
    </div>
    <div class="floating-heart" *ngFor="let i of [1,2,3]" [style.animation-delay]="(i * 1.2) + 's'">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
    </div>
  </div>
  
  <!-- <video class="hero-video" autoplay muted loop playsinline preload="auto">
    <source src="https://videos.pexels.com/video-files/9584768/9584768-uhd_4096_2160_25fps.mp4" type="video/mp4" />
  </video>  --> 
  <div class="hero-content">
    <h1 class="hero-title">Discover Your Next Great Read</h1>
    <p class="hero-subtitle">Explore thousands of books across all genres. Find your perfect story today.</p>
    
    <!-- Call to Action Button -->
    <div class="hero-cta">
      <button class="cta-button" (click)="scrollToBooks()">
        <span class="cta-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
        </span>
        Explore Books
      </button>
    </div>
  </div>
  
  <!-- Featured Books Carousel -->
   
  <div class="featured-carousel" *ngIf="featuredBooks.length > 0">
    <h3 class="hero-title">
      <span class="title-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
        </svg>
      </span>
      {{ isNewUser ? 'Discover Amazing Books' : 'Your Favorites & Recommendations' }}
    </h3>
    <div class="carousel-container">
      <button class="carousel-btn carousel-prev" (click)="previousSlide()" [disabled]="currentSlide === 0">
        <span class="btn-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </span>
      </button>
      <div class="carousel-track" [style.transform]="'translateX(' + carouselOffset + 'px)'">
        <div class="carousel-item" *ngFor="let book of featuredBooks; let i = index" [routerLink]="['/book', book.bookId]">
          <div class="featured-book-card">
            <div class="book-cover-wrapper">
              <img [src]="book.coverImage" [alt]="book.title" class="featured-book-cover" />
              <div class="featured-overlay">
                <span class="featured-badge">
                  {{ isNewUser ? 'Popular' : (book.isFavorite ? 'Favorite' : 'Recommended') }}
                </span>
              </div>
            </div>
            <div class="featured-book-info">
              <h4 class="featured-book-title">{{ book.title }}</h4>
              <p class="featured-book-author">by {{ book.author }}</p>
              <div class="featured-rating">
                <span class="stars">
                  <span *ngFor="let star of [1,2,3,4,5]" [class.filled]="star <= displayRating(book)" class="star">‚òÖ</span>
                </span>
                <span class="rating-text">{{ displayRating(book) | number:'1.1-1' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="carousel-btn carousel-next" (click)="nextSlide()" [disabled]="currentSlide >= maxSlides">
        <span class="btn-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </span>
      </button>
    </div>
    
    <!-- Carousel Indicators -->
    <div class="carousel-indicators" *ngIf="featuredBooks.length > 3">
      <span 
        *ngFor="let indicator of getCarouselIndicators(); let i = index"
        class="indicator" 
        [class.active]="i === currentSlide"
        (click)="goToSlide(i)">
      </span>
    </div>
  </div>
</div>

<div class="genre-toggle">
  <button
    [class.active]="selectedGenre === 'All'"
    (click)="filterByGenre('All')"
  >
    All
  </button>
  <button
    *ngFor="let genre of genres"
    [class.active]="selectedGenre === genre"
    (click)="filterByGenre(genre)"
  >
    {{ genre }}
  </button>
</div>

<div class="book-list" id="books-section">
  <div class="book-card"
    *ngFor="let book of pagedBooks"
    [routerLink]="['/book', book.bookId]">

    <div class="ribbon">Buy 2 Get 1</div>

    <img [src]="book.coverImage" alt="{{ book.title }} cover" class="book-cover" />

    <div class="book-info">
      <h3 class="book-title">{{ book.title }}</h3>
      <p class="book-author">by {{ book.author }}</p>

      <div class="price-row">
        <span class="price-old">Rs. {{ book.priceBuy + 200 }}</span>
        <span class="price-new">Rs. {{ book.priceBuy }}</span>
      </div>

      <div class="rating">
        <span class="stars">
          <span *ngFor="let star of [1,2,3,4,5]" [class.filled]="star <= displayRating(book)" class="star">‚òÖ</span>
        </span>
        <span class="rating-text">{{ displayRating(book) | number:'1.1-1' }}</span>
      </div>

      <button class="add-to-cart-btn" >Know More..</button>
    </div>
  </div>
</div>

<!-- Pagination -->
<div class="pagination" *ngIf="filteredAndSearchedBooks.length > pageSize">
  <button class="page-btn" (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
  <button 
    class="page-btn"
    *ngFor="let p of [].constructor(totalPages); let i = index" 
    [class.active]="(i+1) === currentPage"
    (click)="goToPage(i+1)">{{ i+1 }}</button>
  <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  <span class="page-info">Page {{currentPage}} of {{totalPages}}</span>
  </div>
<!-- ‚úÖ Enhanced Chatbot -->
<div class="chatbot-container" [class.open]="chatOpen">
  <div class="chat-header" (click)="toggleChat()">
    <span class="chat-title">üìö PageFlip Assistant</span>
    <div class="chat-controls" *ngIf="chatOpen" (click)="$event.stopPropagation()">
      <button class="clear-btn" (click)="clearChat($event)" title="Clear chat">üóëÔ∏è</button>
      <button class="minimize-btn" (click)="minimizeChat($event)" title="Minimize">‚ûñ</button>
    </div>
  </div>

  <div class="chat-body" *ngIf="chatOpen">
    <div class="messages" #messagesContainer>
      <div class="message" *ngFor="let msg of chatMessages" 
           [class.user-message]="msg.isUser" 
           [class.bot-message]="!msg.isUser">
        
        <div class="message-content">
          <div class="message-text">{{ msg.text }}</div>
          <div class="message-time">{{ msg.timestamp | date:'short' }}</div>
          
          <!-- Quick suggestions -->
          <div class="suggestions" *ngIf="!msg.isUser && msg.suggestions && msg.suggestions.length > 0">
            <button class="suggestion-btn" 
                    *ngFor="let suggestion of msg.suggestions" 
                    (click)="onSuggestionClick(suggestion)">
              {{ suggestion }}
            </button>
          </div>

          <!-- Book recommendations -->
          <div class="book-recommendations" *ngIf="msg.bookRecommendations && msg.bookRecommendations.length > 0">
            <div class="book-rec" *ngFor="let book of msg.bookRecommendations">
              <img [src]="book.coverImage" [alt]="book.title" class="book-rec-cover">
              <div class="book-rec-info">
                <div class="book-rec-title">{{ book.title }}</div>
                <div class="book-rec-author">{{ book.author }}</div>
                <div class="book-rec-price">‚Çπ{{ book.priceBuy }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Typing indicator -->
      <div class="message bot-message typing-indicator" *ngIf="isTyping">
        <div class="message-content">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <div class="chat-input-area">
      <input
        [(ngModel)]="userInput"
        placeholder="Ask me about books, recommendations, or help..."
        (keydown)="onKeyPress($event)"
        class="chat-input"
      />
      <button class="send-btn" (click)="handleUserInput()" [disabled]="!userInput.trim()">
        üì§
      </button>
    </div>
  </div>
</div>
