<app-navbar (search)="searchQuery = $event"></app-navbar>

<div class="genre-toggle">
  <button
    [class.active]="selectedGenre === 'All'"
    (click)="filterByGenre('All')"
  >
    All
  </button>
  <button
    *ngFor="let genre of genres"
    [class.active]="selectedGenre === genre"
    (click)="filterByGenre(genre)"
  >
    {{ genre }}
  </button>
  
</div>



<div class="book-list">
  <div class="book-card"
    *ngFor="let book of filteredBooks | search:searchQuery"
    [routerLink]="['/book', book.bookId]">



    <div class="ribbon">Buy 2 Get 1</div>

    <img [src]="book.coverImage" alt="{{ book.title }} cover" class="book-cover" />

    <div class="book-info">
      <h3 class="book-title">{{ book.title }}</h3>
      <p class="book-author">by {{ book.author }}</p>

      <div class="price-row">
        <span class="price-old">Rs. {{ book.priceBuy + 200 }}</span>
        <span class="price-new">Rs. {{ book.priceBuy }}</span>
      </div>

      <div class="rating">
        ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
      </div>

      <button class="add-to-cart-btn" >Know More..</button>
    </div>
  </div>
</div>
<!-- ‚úÖ Enhanced Chatbot -->
<div class="chatbot-container" [class.open]="chatOpen">
  <div class="chat-header" (click)="toggleChat()">
    <span class="chat-title">üìö PageFlip Assistant</span>
    <div class="chat-controls" *ngIf="chatOpen" (click)="$event.stopPropagation()">
      <button class="clear-btn" (click)="clearChat($event)" title="Clear chat">üóëÔ∏è</button>
      <button class="minimize-btn" (click)="minimizeChat($event)" title="Minimize">‚ûñ</button>
    </div>
  </div>

  <div class="chat-body" *ngIf="chatOpen">
    <div class="messages" #messagesContainer>
      <div class="message" *ngFor="let msg of chatMessages" 
           [class.user-message]="msg.isUser" 
           [class.bot-message]="!msg.isUser">
        
        <div class="message-content">
          <div class="message-text">{{ msg.text }}</div>
          <div class="message-time">{{ msg.timestamp | date:'short' }}</div>
          
          <!-- Quick suggestions -->
          <div class="suggestions" *ngIf="!msg.isUser && msg.suggestions && msg.suggestions.length > 0">
            <button class="suggestion-btn" 
                    *ngFor="let suggestion of msg.suggestions" 
                    (click)="onSuggestionClick(suggestion)">
              {{ suggestion }}
            </button>
          </div>

          <!-- Book recommendations -->
          <div class="book-recommendations" *ngIf="msg.bookRecommendations && msg.bookRecommendations.length > 0">
            <div class="book-rec" *ngFor="let book of msg.bookRecommendations">
              <img [src]="book.coverImage" [alt]="book.title" class="book-rec-cover">
              <div class="book-rec-info">
                <div class="book-rec-title">{{ book.title }}</div>
                <div class="book-rec-author">{{ book.author }}</div>
                <div class="book-rec-price">‚Çπ{{ book.priceBuy }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Typing indicator -->
      <div class="message bot-message typing-indicator" *ngIf="isTyping">
        <div class="message-content">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <div class="chat-input-area">
      <input
        [(ngModel)]="userInput"
        placeholder="Ask me about books, recommendations, or help..."
        (keydown)="onKeyPress($event)"
        class="chat-input"
      />
      <button class="send-btn" (click)="handleUserInput()" [disabled]="!userInput.trim()">
        üì§
      </button>
    </div>
  </div>
</div>
